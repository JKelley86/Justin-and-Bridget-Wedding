<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Data</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            background-image: url('picture1.jpeg');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: transparent;
        }
        h1, h2 {
            text-align: center;
        }
        .additional-info {
            display: none;
        }
        .search-button {
            width: 25%; /* Adjust width as needed */
            margin: 0 auto; /* Center horizontally */
            display: block; /* Ensures margin auto works */
            margin-bottom: 80px; /* Add margin below the search button */
        }
            #songInput {
            width: 25%; /* Adjust width as needed */
            margin: 0 auto; /* Center horizontally */
            display: block; /* Ensures margin auto works */
}
            #login {
            width: 25%; /* Adjust width as needed */
            margin: 0 auto; /* Center horizontally */
            display: block; /* Ensures margin auto works */
}

    </style>
</head>
<body>
    <div class="container">
        <nav>
            <ul class="navbar-left">
                <li><a href="index.html">Home</a></li>
                <li><a href="location.html">Info</a></li>
                <li><a href="rsvp.html">RSVP</a></li>
                <li><a href="Justin.HTML">Spotify</a></li>
            </ul>
            <div class="navbar-right">Justin & Bridget's Wedding</div>
        </nav>  
        <h1>Google Sheets Data</h1>

        <h3>Pricing</h2>
        <p>Click on any cell to expand</p>
        <table id="data-table-1">
            <thead>
                <tr id="table-header-1"></tr>
            </thead>
            <tbody id="table-body-1"></tbody>
        </table>

        <h3>Guest List</h2>
        <table id="data-table-2">
            <thead>
                <tr id="table-header-2"></tr>
            </thead>
            <tbody id="table-body-2"></tbody>
        </table>

        <h3>Spotify Playlist Manager</h1>
        <button id="login">Log in with Spotify</button>

        <div id="playlist"></div>

        <h3>Add a Song</h2>
        <input type="text" id="songInput" placeholder="Type a song name">
        <button id="search" class="search-button">Search</button>
        <div id="searchResults"class="search-button"></div>
        
        <footer> 
            <span>&copy; 2024 Justin & Bridgetâ€™s Wedding. All rights reserved.</span>
        </footer> c
    </div>

    <script>
        function start() {
            gapi.client.init({
                apiKey: 'AIzaSyA5jLLGajXFA-oUlV3kNMleLNKXyDUZTQA', // Replace with your API key
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            }).then(function() {
                // Fetch data from the first sheet
                gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: '1-fKBxtivoEn6Eg5rOZxjt-BzzKIhaBTzgNrPjAs9Qxo', // Replace with your spreadsheet ID
                    range: 'Pricing!A2:C30', // Adjust the range as needed
                }).then(function(response) {
                    var data = response.result.values;
                    populateTableWithExpandableRows(data, 'table-header-1', 'table-body-1');
                }).catch(function(error) {
                    console.log('Error fetching first sheet: ' + error.result.error.message);
                });

                // Fetch data from the second sheet
                gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: '1-fKBxtivoEn6Eg5rOZxjt-BzzKIhaBTzgNrPjAs9Qxo', // Replace with your spreadsheet ID
                    range: 'Guest List!A76:D140', // Adjust the range as needed
                }).then(function(response) {
                    var data = response.result.values;
                    populateTable(data, 'table-header-2', 'table-body-2');
                }).catch(function(error) {
                    console.log('Error fetching second sheet: ' + error.result.error.message);
                });
            }).catch(function(error) {
                console.log('Error initializing Google API client: ' + error.result.error.message);
            });
        }

        function populateTableWithExpandableRows(data, headerId, bodyId) {
            const tableHeader = document.getElementById(headerId);
            const tableBody = document.getElementById(bodyId);

            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';

            const headers = data[0];
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                tableHeader.appendChild(th);
            });

            for (let i = 1; i < data.length; i++) {
                const tr = document.createElement('tr');
                data[i].forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });

                // Add event listener to row to fetch additional data when clicked
                tr.addEventListener('click', () => {
                    toggleAdditionalData(`Option${i}`, tr);
                });

                tableBody.appendChild(tr);

                // Create a hidden row for additional information
                const additionalTr = document.createElement('tr');
                additionalTr.className = 'additional-info';
                const additionalTd = document.createElement('td');
                additionalTd.colSpan = headers.length;
                additionalTd.id = `additional-info-${i}`;
                additionalTr.appendChild(additionalTd);
                tableBody.appendChild(additionalTr);
            }
        }

        function populateTable(data, headerId, bodyId) {
            const tableHeader = document.getElementById(headerId);
            const tableBody = document.getElementById(bodyId);

            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';

            const headers = data[0];
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                tableHeader.appendChild(th);
            });

            for (let i = 1; i < data.length; i++) {
                const tr = document.createElement('tr');
                data[i].forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            }
        }

        function toggleAdditionalData(option, row) {
            const additionalRow = row.nextElementSibling;
            if (additionalRow.style.display === 'table-row') {
                additionalRow.style.display = 'none';
            } else {
                fetchAdditionalData(option, additionalRow);
            }
        }

        function fetchAdditionalData(option, additionalRow) {
            const ranges = {
                'Option1': 'Website!E3:H31',
                'Option2': 'Website!M3:P31',
                'Option3': 'Website!A3:D31',
                'Option4': 'Website!I3:L31',
                'Option5': 'Website!Y3:Z8',
                'Option6': 'Website!AA3:AB8',
                'Option7': 'Website!U3:X31',
                'Option8': 'Website!AC3:AD7',
                'Option9': 'Website!AE3:AF7',
                'Option10': 'Website!AG3:AI7',
                'Option11': 'Website!AJ3:AM31',
                // Add more options and ranges as needed
            };

            const range = ranges[option];

            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: '1-fKBxtivoEn6Eg5rOZxjt-BzzKIhaBTzgNrPjAs9Qxo', // Replace with your spreadsheet ID
                range: range,
            }).then(function(response) {
                var data = response.result.values;
                populateAdditionalRow(data, additionalRow);
            }).catch(function(error) {
                console.log('Error fetching additional data: ' + error.result.error.message);
            });
        }

        function populateAdditionalRow(data, additionalRow) {
            const additionalTd = additionalRow.querySelector('td');

            additionalTd.innerHTML = '';

            const table = document.createElement('table');
            table.style.width = '100%';
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');
            table.appendChild(thead);
            table.appendChild(tbody);

            const headers = data[0];
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            for (let i = 1; i < data.length; i++) {
                const tr = document.createElement('tr');
                data[i].forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            }

            additionalTd.appendChild(table);
            additionalRow.style.display = 'table-row';
        }

        gapi.load('client', start);

        // Spotify API integration
        const clientId = '63c344ed973e43959100ba9a9293c8f2';
        const redirectUri = 'https://jkelley86.github.io/Justin-and-Bridget-Wedding/secret.html';
        const playlistId = '0Hp97WtisDeOpAN76fBDqs';
        const scopes = 'playlist-modify-public playlist-modify-private';

        const loginButton = document.getElementById('login');
        const playlistContainer = document.getElementById('playlist');
        const searchButton = document.getElementById('search');
        const searchResults = document.getElementById('searchResults');

        function getHashParams() {
            const hashParams = {};
            let e, r = /([^&;=]+)=?([^&;]*)/g,
                q = window.location.hash.substring(1);
            while (e = r.exec(q)) {
                hashParams[e[1]] = decodeURIComponent(e[2]);
            }
            return hashParams;
        }

        const params = getHashParams();
        const accessToken = params.access_token;

        if (!accessToken) {
            loginButton.style.display = 'block';
            loginButton.onclick = () => {
                const url = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scopes)}`;
                window.location = url;
            };
        } else {
            loginButton.style.display = 'none';
            fetchPlaylist();
        }

        function fetchPlaylist() {
            fetch(`https://api.spotify.com/v1/playlists/${playlistId}`, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                displayPlaylist(data);
            })
            .catch(error => console.error('Error:', error));
        }

        function displayPlaylist(playlist) {
            if (!playlist.tracks.items.length) {
                playlistContainer.innerHTML = 'No tracks found in this playlist.';
                return;
            }
            playlistContainer.innerHTML = `<h2>${playlist.name}</h2><ul>` + 
                playlist.tracks.items.map(item => `<li>${item.track.name} by ${item.track.artists.map(artist => artist.name).join(', ')}</li>`).join('') + 
                '</ul>';
        }

        searchButton.onclick = () => {
            const query = document.getElementById('songInput').value;
            searchSong(query);
        };

        function searchSong(query) {
            fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track`, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                displaySearchResults(data.tracks.items);
            })
            .catch(error => console.error('Error:', error));
        }

        function displaySearchResults(tracks) {
            if (!tracks.length) {
                searchResults.innerHTML = 'No results found.';
                return;
            }
            searchResults.innerHTML = '<ul>' + 
                tracks.map(track => `<li>${track.name} by ${track.artists.map(artist => artist.name).join(', ')} 
                <button onclick="addSongToPlaylist('${track.uri}')">Add to Playlist</button></li>`).join('') + 
                '</ul>';
        }

        window.addSongToPlaylist = (trackUri) => {
            fetch(`https://api.spotify.com/v1/playlists/${playlistId}/tracks`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    uris: [trackUri]
                })
            })
            .then(response => {
                if (response.ok) {
                    fetchPlaylist();
                } else {
                    return response.json().then(error => Promise.reject(error));
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
